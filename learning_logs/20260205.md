# SQL

1. data.zip 압축 풀기
2. heidiSQL 실행
3. 햄버거 -> 도구 -> csv파일 가져오기

chrome -> dbeaver 검색

# SQL문

- 최근에는 NoSQL 개념이 뜨고 있기는 하지만 대부분 IT서비스 데이터가 저장되는 곳은 관계형 데이터베이스(Relarional DataBase : RDB)인데, 해당 DB에 접근할 수 있는 프로그래밍언어가 SQL(Structured Query Language : 구조화된 질의 언어) 문 
그래서 데이터가 저장된 곳에 특정 조건을 만족하는 데이터를 조회하는 부분을 옛날에는 개발팀에서 맡아서 했엇기 때문에 다른 직군의 직원들이 개발팀에 요청을 해왔었음.

  - 마케팅 부서에서 프로모션 기간동안 매출 증가 자료를 개발팀에 요청
  - 개발팀은 해당 자료에 대한 SQL을 조직해서 실행한 다음에 필요한 대이터를 뽑아냄
  - 업무 담장자 에게 회신

이런 과정을 거쳤었는데, 최근에는 개발직군이 아닌 분들이 SQL을 직접 다루는 방식으로 스스로 처리할수 있게씀 하고있음.

  - 원래는 사내 DB를 일반 직원들에게 오픈하는걸 꺼렸엇는데 요즘엔 그냥 다 오픈하는 분위기로 가다보니까 엄청 보수적인 곳이 아니면 기본적으로 SQL역량은 탑재하는 느낌
  - 그래서 특정 매출 자료를 분석하고 시각화해서 브리핑 하면서 인사이트를 얻을수 있도록 보조한다면 데이터 분석가가 됨.

  - 컴퓨터에게 데이털르 가져오라는 일을 시킬때 그 형식이 어느정도 정해져있는ㄷ 질의 언어로 컴퓨터에게 잘 시키는 언어, 라고 할수있음

  - 기본적으로 RDB를 다루기 위해 고안된 언어이기 때문에 NoSQL에서는 조금 다른 방식으로 작동하는 경우가 있음. 
    (NoSQL - 1. 아예 SQL을 안씀/ 2. Not Only SQL - SQL문만 써서 데이터베이스를 다루는게 아님) 
    그러다 보니까 개발자직군은 일반 직군으로 내려온 SQL으로 RDB다루기 + NoSQL 역략이 필요하게 됨.

  - 컴퓨터는 생각보다 멍청하기 때문에 - 어디에서, 무엇을 가져와야 하는지를 명시해야함.

  - 예를들어 밥먹고 하자는 얘기 했을때 수업 그만하자라고 알아들은 것과는 달리 컴퓨터한테는 밥 메뉴가 정해져있지않은데 밥먹고(무엇을) 한다는 건지도 명시해줘야 됨. 그러면 밥먹고 하자는 컴퓨터에게는 여러 오류를 일으킬수 있다는 의미가 됨.
  ```sql
  - 데이터를 가져다줘 전부 다
    저장소 위치가 어디냐면 table_table이야
    명령 끝났다.

  - SELECT *
    FROM table_table
    ;
  ```

  이 됨.

  ## SQL의 종류
  1. DML : 데이터 조직 언어라고 보통 번역되고 DB의 내부 데이터를 관리하기 위한 기능. 주로 CRUD의 기능을 수행하기 때문에 주요 명령어로 `INSERT, SELECT, UPDATE, DELETE`

  2. DDL : 데이터 정의 언어로 번역되고 EDB내의 저장 단위인 테이블과 컬럼을 정의하고 관리하ㅓ는 ㅁ여렁어를 포함. 저장공간을 생성하고 수정하고 삭제하는 등의 데이터 저장 공간을 결정
  `CREATE, DROP, TRUNCATE`

  3. DCL : 사용자 권한을 부여하거나 회수

  ## 알아두면 좋은 필수개념
  - 데이터 베이스 : 데이터를 저장하고 관리하는 시스템;

  - 관계형 데이터베이스: 데이터를 테이블 형태로ㅓ 관리하는 데이터 베이스

  - 테이블 : RDB내에서 행과 열로 구성된 데이터를 저장하는 기본 단위

  - 컬럼: 테이블에서 하나의 속성에 해당하는 데이터를 저장하는 공간으로 세로 줄인 열에 해당.

```java
@Entity

public class Person{
  private String name;
  private Integer studentId;
}
```

와 같은 클래스가 있다고 가정했을때 이를 개체 생성하고 DB에 저장했다면 person 테이블에 각 컬럼이 name/studentId가 됨.
그러니 컬럼명이 field가 될텐데, 각 컬럼이 가지는 제약 조건으로 설정된것이 - private이고, 데이터 타입이 String / Integer가 됨.

- 행(row) : 테이블에서 가로줄을 의미하고 SQL에선 레코드 (record)라고 부르기도 함. 

```java
public class Main{
  public static void main(string[] args) {
    Person person1 = new Person('김일', 2026001);
  }
}
```

와 같이 객체를 생성했을때 테이블에 김일, 20206001이라는 row가 하나 생김. 즉, 우리가 적었던 record라는 가로줄 하나는 Java적으로 봤을때 테이블/클래스명을 지니는 클래스의 인스턴스에 해당한다고 볼수있음.

기본키 : 기본키는 테이블에서 각 행을 고유하게 식별할수 있는 값. 기본 키는 하나가 아닌 여러값의 조합으로 이루어지는것도 가능. 이러한 기본 키는 테이블 내에서 중복되지않는 유일한 값을 가져야함.

외래키 : 외래 키는 다른 테이블의 기본 키와 매칭되어 해당 테이블과의 관계를 정의함. 다른 테이블의 기본 키 값을 가져와서 컬럼을 구성하며, 이후 테이블 끼리 혈합 할때 사용. 일반적으로 다른 테이블의 기본 키와 같은 데이터타입과 크기를갖는다.

# 원하는 데이터를 가지고 오고 필터링 하기

1. 데이터 처림 4 요소 : 생성 / 조회 / 수정 / 삭제 - CRUD
  - SQL 뿐만 아니라 다른 프로그래밍 데이터 처리 개념 자체는 존재함.
  - SQL은 관계형 데이터베이스(RDB)의 데이터를 다루는 주요 언어에 해당
2. 이번 수업에선 기본적으로 더미 데이터를 가지고 있는 상황에서 다양한 조건에 해당하는 데이터들을 필터링해서 가지고 오는 부분에 초점을 맞출 예정.

## SELCET (설렉트)
```sql
SELECT 'Hello SQL!'
```
- 이미 알고있는 사람도 있겠지만 SELECT문의 경우에는 어느 컬럽ㅁ을 보여줄지를 지정하는 역할을 함. 하지만 FROM 절을 작성하지않은 상태에서는 SECLET뒤에 문자열을 기준으로 컬럼명을 생성하고 내부에 row를 그대로 보여줌

* 참고 : 대소문자 구분 안함. 하지만 시험상황에서 보통 SQL 명령문은 대문자로 작성되기 때문에 md파일에 대문자로 SQL문을 데이터를 소문자로 작성하도록함.
- SELECT : ~ 를 보여달라.
```sql
SELECT 'Hello SQL!'; /* 여기서는 str이 아니라 varchar라고 함.*/
보여달라 이내용을
```
- 데이터 조회를 시작할때 늘 SELECT로 시작하기 때문에 CRUD중 R업무를 시작한다고 해석하면 됨.

```sql
SELECT 12+7;
```

- AS : 

```sql
SELECT 'Hello, SQL!' AS 인사;
```

  결과창의 첫 행(row)dp 각각 Find / Insight / With SQL 이라는 문구가 출력 될수 있도록 SQL문을 작성하시오. 단 제목을 나타내는 컬럼명은 각각 순서대로 First, Second. Third로 작성하시오 . (힌트 : 다수의 내용을 표기활때는 ','로 연결)

  - 결과
  ```sql
  SELECT 'Find' AS 'First',
   'Insight' AS 'SECOND' ,
    'With SQL' AS 'Third'
  ```

  AS가 없어도 그냥 나오기는 하지만 FROM절을 이용해 TABLE을 조회할거기 때문에 길게는 안 다룸. 다만 '컬럼명'을 바꿀수 있다는 점은 집계함수의 적용여부라 합쳐져거 매우 중요함.

- 과제
  1. SELECT 문을 활용 28 + 291 결과를 표시하시오.
  2. 19 * 27 하시오.
  3. 세 가지 결과를 각기 다른 컬럼으로 결과창에 푯시하시오.
    - 27 + 172 (컬럼명 Plus)
    - 25 * 78 (컬럼명 Times)
    - I love SQL! (컬럼명 Result)

```sql
SELECT 28 + 172 AS Plus,
 19*27 AS Times,
 'I love SQL!' AS Result;
```

## FROM
1. 데이터가 저장된 위치를 알려주는 부분. 개발자가 컴퓨터에게 알려준다고 생각하면 됨,

```sql
SELECT *
	FROM users
	;
```

- `*` : 별표 / 와일드카드 / 에스터리스크 라고 불리며 테이블 내의 모든 컬럼을 지시함. (Java / SpringBoot에서도 쓸거)
  - python에서 hangman할때 `from hangman_arts import`에서 사용했음.

- `*`는 패턴 매칭에서 하나 이상의 문자를 대체할수 있는 기회를 의미함. 패턴 매칭이랑 문지열, 파일, 데이터 등에서 주어진 패턴이나 규칙에 맞는 부분을 찾아내는 과정으로 예를들어 `*.text`라면 모든 text파일 확장자를 지닌 애들을 가리킴

- 개행과 들여쓰기는 python과 달리 아무런 영향을 끼치지않음. 그냥 가독성 때문에 사용하는건데 이게 회사마다 쓰는 방법이 고착 되어있어서 유연하게 작성하는 방법을 익히는게 좋음.

```sql
SELECT *
	FROM users
	LIMIT 3
	;
```

전체 데이터가 아니라 일부 데이터만 가지고 오기 위해서 개수를 지정하는 명령어로 `LIMIT`를 씀. 어느 DB를 쓰는가에 따라 다른데 `TOP`쓰는 곳도 있음.

full scan: 특정 테이블의 모든 정보를 조회하는 것으로 우리야 모의 데이터를 쓰지만 인스타그램 회원정보를 풀스캔 한다고 치면 컴퓨터에 부담이 많이가기 때문에 단순히 데이터를 파악하고 싶다면 LIMIT/ TOP을 쓰는 습관을 들이는게 정신건강에 좋음

과제
1. orderdetails 테이블의 전체 컬럼을 표시하시오.
2. users에서 상위 7건의 데이터만 표시하시오.
3. orders에서 주문 아이디 / 회원 아이디 / 주문 일자 컬럼의 모든 데이터를 표시하시오. 

```sql
SELECT *
	FROM orderdetails
	;
	
SELECT *
	FROM users
	LIMIT 7
	; 
	
SELECT id, user_id, order_date 
	FROM orders
	;
```

## WHERE
  1. 어떤 것을 고를지 설정
  - SELECT / FROM 에서 보여줄 내용을 지정하고, 가져올 테이블을 정했는데, LEMIT를 통해 일부 개수만 가지고 오는게 아니라 어떤 컬럼의 값이 A인것만 가져온다던지, 성별이 여자인 회원의 정보만 가져온다든지 또는 배송비가 무료인 것만 가져온다는지 하는 일종의 필터를 거쳐야 하는경우가 있음. 이럴때 사용하는게 WHERE절에 해당함. WHERE은 조건을 만족하는 데이터만 가져오도록 제한함.

  2. SELECT 절에서는 세로 부분인 컬럼을 제어했다면 (필요한 컬럼만 뽑아낼수 있었으니까) WHERE절에서는 특정한 row만 가지고 오도록 제어함.

  3. 회원정보 테이블에서 거주 국가가 Korea인 회원만 전체 컬럼을 추출하기

  - 데이터 전처리 : 혹시 회원이 Republic of Korea로 등록 헀는지/ South Korea로 등록했는지 아니면 Korea로 했는지등 

```sql
SELECT *
  FROM users
  WHERE country = 'Korea'
  ;
```

그렇다면 거주국가가 한국이 아닌 회원의 전체 컬럼을 출력한다면

```sql
SELECT *
	FROM users
	WHERE country !='Korea'
	;
```

  - `!`가 not연산을 한다는 것을 확인함.
  - 논리 연산자 `AND` / `OR`도 존재함

users에서 거주국가가 한국이면서 회원 아이디가 10인 회원만 추출하시오.

```sql
SELECT *
	FROM users
	WHERE country ='Korea' AND id = 10
	;
```

users에서 가입일시가 2010-12-01부터 2011-01-01인 회원 정보를 출력하기

```sql
SELECT *
  FROM users
  WHERE created_at BETWEEN '2010-01-01' AND '2011-01-01'
  ;
```

- `BETWEEN`은 실제 쿼리 작성 시 날짜 조건을 적용할때 자주 사용. [시작날짜]와 [종료날짜]를 포함한 그 사이 값을 조회하는데, created_at의 결과값들을 확인해보면 yyyy-mm-dd HH:MM:SS 형태로 작성이 되어있는데, 조건을 '년월일'까지만 작성한다면 시/분/초 조건을 0으로 인식하여 알아서 계산함.

- 문제 : 회원 정보 테이블에서 가입일시가 2010-12-01 부터 2011-01-01까지인 회원정보 전체 컬럼을 출력하는데 BETWEEN은 쓰지말고 작성하시오
```sql
SELECT *
	FROM users
	WHERE created_at >= '2010-12-01' AND created_at <= '2011-01-01'
	;
```

- users에서 거주 국가가 Korea 거나 UK 거나 USA인 회원정보만 추출하시오

```sql
SELECT *
	FROM users
	WHERE country = 'Korea' OR country = 'UK' OR country = 'USA'
	;	
-- -------------------------------------------------------------------
SELECT *
	FROM users
	WHERE country IN ('Korea','UK','USA')
	;
```

* 참고사항 : AND / OR 연산자 중에 AND가 더 우선순위가 높음.
  - WHERE절에서 실행되는 순서가 더 빠름. 그래서 AND / OR을 한 WHERE절 내에서 동시에 작성할 경우 AND 조건이 먼저 실행됨.

- `!` 만 있는게 아니라 `NOT`도 존재함.

- 문제 : users에서 국가가 한국도 미국도 아닌 회원정보를 추출하시오

```sql
SELECT *
	FROM users
	WHERE country NOT IN ('Korea','UK','USA')
	;
```

- 예시 : users에서 거주국가가 S로 시작하는 회원정보 추출하기

```sql
SELECT *
  FROM users
    WHERE country LIKE 'S%'
    ;
```

- `LIKE` : WHERE 조건문을 작성할때 일부 패턴에 일치하는 데이터만 검색할수 있다는 점에서 가치가 있음. LIKE 뒤의 ''/"" 뒤에서는 와일드카드를 사용할수 있는데, 여기서는 `%`를 의미함. % 는 0개 이상의 임의의 문자열 패턴을 의미하는 메타문자에 해당함.
`_`는 임의의 문자 한개를 의미함.

```sql
SELECT *
  FROM users
    WHERE country LIKE 'U_'
    ;
```

- 그래서 이상의 결과값으로 UK만 나오지 USA는 추출되지않음.

- 문제 : users에서 거주 국가의 이름이 S로 시작하지않는 회원정보만 추출하시오.

```sql
SELECT *
  FROM users
    WHERE country NOT LIKE 'S%'
    ;
```

- 예시 : users에서 가입일시 컬럼의 값이 null인 결과만 출력하기

```sql
SELECT *
  FROM users
  WHERE created_at IS null
  ;
```

- `null` : 값잉 ㅓㅄ는 상태를 의미함. 0 이거나 ''(공백)도 아님. 진짜 그런 아무런 ㄱ밧도 없다는 의미로 쓰이기때문에 Java에서 int a; 한 다음 System.out.println(a)하면 0 나오는거랑 좀 다음.

- `IS` : null은 0도 아니고 ''도 아니기 떄문에 어떤 조건 값으로도 _조회할수없음._ 이러한 null 값을 필터링할때 쓰이는 조건 연산자가 IS

- 문제 : user에서 created_at 이 null이 아닌 것만 추출

```sql
SELECT *
	FROM users
	WHERE created_at IS NOT null
	;
```

- 문제
  1. users에서 거주 국가가 멕시코인 회원정보를 가입일시, 연락처, 거주도시 , 거주 국가 컬럼만 출력

```sql
SELECT created_at, phone,city,country
  FROM users
  WHERE country = 'mexico';
```

  2. products에서 제품 아이디가 20 이하이고, 정상가격은 30 이상인 제품의 정보를 출력하시오. 단 기존의 컬럼은 모두 출력하는데, 정상가격에서 얼마나 할인 되었는지를 discount_amount라는 컬럼명으로 이름 지으시오.

```sql
SELECT *, (price - discount_price) AS discount_amount
  FROM product  
  WHERE id <= 20 AND price >= 30; 
```

  3. users에서 거주 국가가 한국/캐나나/벨기에가 아닌 회원 정보를 OR 연산자를 사용하지않고 출력하시오.

```sql
SELECT *
  FROM users
  WHERE country NOT IN ('Korea','Canada','Belgium');

SELECT *
  FROM users
  WHERE country != 'Korea' AND country != 'Canada' AND country != 'Belgium';
```

  4. product에서 제품명이 N으로 시작하는 제품의 정보를 출력하는데 , 제품 아이디, 제품명, 정상가격 컬럼만 출력하시오.

```sql
SELECT id, name, price
  FROM products
  WHERE name LIKE 'N%';
```

  5. orders 테이블에서 주문일자가 2015-07-01 부터 2015-10-31까지가 아닌 정보만 출력 하시오.

```sql
SELECT order_date
  FROM orders
  WHERE order_date NOT BETWEEN '2015-07-01' AND '2015-10-31';
```

# 내일 수업 내용 부분
ORDER BY